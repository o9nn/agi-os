# üîß Aphrodite Engine DevContainer & Self-Healing System

This document describes the optimized development container and self-healing workflow system for Aphrodite Engine with Deep Tree Echo integration.

## üéØ Overview

### DevContainer Features
- **Multi-Architecture Support**: CPU, CUDA, ROCm, TPU, XPU target devices
- **Optimized Build Environment**: CMake 3.26+, Ninja, ccache for fast rebuilds
- **GUI Applications**: X11 forwarding, VNC, browser automation support
- **Deep Tree Echo Integration**: Specialized tools and environment for Echo systems
- **Development Tools**: Python 3.12, ruff, mypy, pytest, pre-commit hooks

### Self-Healing System Features
- **Automated Error Detection**: Monitors build failures, test failures, import errors
- **Intelligent Issue Creation**: Context-aware GitHub issues with diagnostics
- **Auto-Assignment**: Issues automatically assigned to dtecho and drzo
- **Recovery Procedures**: Automated rollback and recovery mechanisms
- **Deep Tree Echo Monitoring**: Specialized monitoring for Echo system components

## üöÄ Quick Start

### Using the DevContainer

1. **Open in VS Code**:
   ```bash
   # With VS Code
   code .
   # Select "Reopen in Container" when prompted
   ```

2. **Build Aphrodite Engine**:
   ```bash
   ./quick-start.sh build
   ```

3. **Run Tests**:
   ```bash
   ./quick-start.sh test
   ```

4. **Check Status**:
   ```bash
   ./quick-start.sh status
   ```

### Target Device Configuration

Set the target device via environment variable:
```bash
# CPU-only (default)
export APHRODITE_TARGET_DEVICE=cpu

# NVIDIA GPU
export APHRODITE_TARGET_DEVICE=cuda

# AMD GPU  
export APHRODITE_TARGET_DEVICE=rocm

# Google TPU
export APHRODITE_TARGET_DEVICE=tpu

# Intel XPU
export APHRODITE_TARGET_DEVICE=xpu
```

## üìÅ DevContainer Structure

```
.devcontainer/
‚îú‚îÄ‚îÄ devcontainer.json     # Main configuration
‚îú‚îÄ‚îÄ Dockerfile           # Container image definition
‚îú‚îÄ‚îÄ init-xserver.sh      # X11 server initialization
‚îú‚îÄ‚îÄ post-create.sh       # Post-creation setup
‚îî‚îÄ‚îÄ post-start.sh        # Startup script
```

### Key Features

#### Development Environment
- **Python 3.12** with full development stack
- **CMake 3.26+** for C++ extension builds
- **Ninja build system** for parallel compilation
- **ccache** with 5GB cache for faster rebuilds
- **Code quality tools**: ruff, mypy, isort, black

#### GUI Support
- **X11 forwarding** via Xvfb virtual display
- **VNC server** on port 5901 for remote access
- **Browser automation** with Playwright and Selenium
- **Window manager** (Fluxbox) for GUI applications

#### Deep Tree Echo Integration
- **Echo system directories** monitoring
- **DTESN processor** development tools
- **AAR orchestration** debugging capabilities
- **Memory management** profiling tools

#### Ports and Services
- `2242` - Aphrodite Engine API server
- `8000` - Alternative API port
- `6006` - TensorBoard visualization
- `8888` - Jupyter notebooks
- `5901` - VNC display server

## üîß Self-Healing Workflow System

### Architecture

The self-healing system consists of several components:

1. **Error Detection Engine** (`.github/scripts/self-healing-system.py`)
2. **Workflow Automation** (`.github/workflows/self-healing-workflow.yml`)
3. **Configuration Management** (`.github/config/self-healing-config.yaml`)

### Error Detection Categories

#### Build Failures
- CMake configuration errors
- Compilation failures
- Linking errors
- Dependency issues
- **Severity**: High
- **Auto-recovery**: Clean + rebuild

#### Test Failures
- Segmentation faults (critical severity)
- Import errors
- Test timeouts
- Assertion failures
- **Severity**: Medium to Critical
- **Auto-recovery**: Clean test environment

#### Deep Tree Echo Errors
- DTESN processor failures
- Missing Echo components
- AAR orchestration errors
- Memory system failures
- **Severity**: High
- **Components**: echo.kern, echo.self, echo.dash, etc.

#### Import Errors
- Core module failures (critical)
- Optional module errors (medium)
- Missing dependencies
- **Severity**: Medium to Critical
- **Auto-recovery**: Reinstall packages

### Workflow Triggers

The self-healing workflow is triggered by:

1. **Workflow Failures**: When build/test workflows fail
2. **Manual Dispatch**: For testing and debugging
3. **Code Changes**: On pushes to main/develop branches
4. **Scheduled Checks**: Periodic health monitoring

### Issue Creation Process

When a blocking error is detected:

1. **Analysis**: Error categorization and severity assessment
2. **Deduplication**: Check for existing similar issues
3. **Issue Creation**: Generate detailed issue with diagnostics
4. **Assignment**: Auto-assign to dtecho and drzo
5. **Labeling**: Apply appropriate labels for categorization
6. **Monitoring**: Track resolution progress

### Issue Template Example

```markdown
## üö® Blocking Error Detected - Self-Healing System

**Auto-generated by the Self-Healing System**
**Detection Time**: 2024-01-15 14:30:00 UTC
**Error Type**: build_failure
**Severity**: HIGH

### üìã Error Details
**Location**: `build/CMakeFiles/CMakeError.log`
**Error Message**: `CUDA compiler not found`

### üõ†Ô∏è Immediate Actions Required
#### For @dtecho and @drzo:
- [ ] Acknowledge this blocking error within 1 hour
- [ ] Investigate root cause using provided information
- [ ] Implement fix or workaround
- [ ] Verify resolution and system stability

### üîÑ Suggested Recovery Steps
1. **Check CUDA Installation**:
   ```bash
   nvcc --version
   which nvcc
   ```

2. **Reinstall CUDA Toolkit**:
   ```bash
   export CUDA_VERSION=12.4
   # Installation steps...
   ```
```

### Configuration

The system behavior is controlled by `.github/config/self-healing-config.yaml`:

```yaml
assignments:
  default_assignees: ["dtecho", "drzo"]
  
error_detection:
  categories:
    build_failures:
      enabled: true
      severity_mapping:
        cmake_error: "high"
        compilation_error: "high"
        
recovery:
  auto_recovery:
    enabled: true
    max_attempts: 3
```

## üõ†Ô∏è Development Workflow

### Daily Development

1. **Start Development**:
   ```bash
   # Container starts automatically with VS Code
   ./quick-start.sh status
   ```

2. **Make Changes**:
   ```bash
   # Edit code with full IDE support
   # Auto-formatting on save
   # Real-time linting with ruff
   ```

3. **Test Changes**:
   ```bash
   ruff check . --fix          # Fix linting issues
   ./quick-start.sh test       # Run basic tests
   pytest tests/ -v            # Full test suite
   ```

4. **Build and Deploy**:
   ```bash
   ./quick-start.sh build      # Build engine
   ./quick-start.sh serve      # Start API server
   ```

### Error Handling

When errors occur:

1. **Automatic Detection**: Self-healing system detects blocking errors
2. **Issue Creation**: GitHub issue created with full diagnostics
3. **Assignment**: Assigned to dtecho and drzo automatically
4. **Recovery**: Automatic recovery attempted if possible
5. **Monitoring**: Progress tracked until resolution

### GUI Applications

For Deep Tree Echo development:

```bash
# Start X server (if not running)
bash /usr/local/bin/init-xserver.sh

# Test GUI applications
DISPLAY=:1 firefox &
DISPLAY=:1 python gui_app.py

# Access via VNC at localhost:5901
```

## üìä Monitoring and Metrics

### System Health Checks

- **Build System**: CMake, dependencies, compilation tools
- **Python Environment**: Module imports, package integrity
- **Deep Tree Echo**: Component availability, processor status
- **Test Environment**: Test suite health, coverage metrics

### Error Metrics

- Error detection rate
- Resolution time tracking
- Auto-recovery success rate
- Issue creation patterns

### Performance Monitoring

- Build times with ccache
- Test execution times
- Container startup performance
- Resource utilization

## üîß Customization

### Environment Variables

```bash
# Build configuration
export MAX_JOBS=8                    # Parallel build jobs
export CMAKE_BUILD_TYPE=Release      # Build type
export CCACHE_MAXSIZE=10G           # Cache size

# Deep Tree Echo
export ECHO_ENABLE_DEEP_TREE=true   # Enable Echo systems
export DEEP_TREE_ECHO_MODE=development  # Development mode

# Display settings
export DISPLAY=:1                    # X11 display
export XAUTHORITY=/tmp/.Xauthority   # X11 auth
```

### Adding Custom Tools

Edit `.devcontainer/Dockerfile`:
```dockerfile
# Add custom development tools
RUN pip install your-custom-package

# Add system packages
RUN apt-get update && apt-get install -y your-package
```

### Modifying Self-Healing Behavior

Edit `.github/config/self-healing-config.yaml`:
```yaml
# Change assignees
assignments:
  default_assignees: ["your-username"]

# Add new error types
error_detection:
  categories:
    your_custom_errors:
      enabled: true
      severity_mapping:
        your_error: "high"
```

## üö® Troubleshooting

### Common Issues

#### Container Build Fails
```bash
# Check Docker resources
docker system df
docker system prune

# Rebuild container
Ctrl+Shift+P -> "Dev Containers: Rebuild Container"
```

#### X Server Not Working
```bash
# Restart X server
bash /usr/local/bin/init-xserver.sh

# Check display
echo $DISPLAY
ls -la /tmp/.X11-unix/
```

#### Build Failures
```bash
# Clear build cache
rm -rf build/ dist/ *.egg-info/
ccache -C

# Reinstall dependencies
pip install -r requirements/build.txt
```

#### Self-Healing Not Triggering
```bash
# Test manually
python .github/scripts/self-healing-system.py --dry-run --verbose

# Check workflow logs
# GitHub Actions -> Self-Healing Workflow
```

### Debug Commands

```bash
# Container status
echo-status                    # Show environment
aphrodite-build               # Build with verbose output
aphrodite-test               # Test installation

# System diagnostics
./quick-start.sh status       # Full system status
ccache --show-stats          # Build cache status
df -h                        # Disk usage
```

## ü§ù Contributing

### Adding New Error Detection

1. **Edit detection script**: `.github/scripts/self-healing-system.py`
2. **Add error category**: Add new detector method
3. **Update configuration**: `.github/config/self-healing-config.yaml`
4. **Test detection**: Run with `--dry-run` flag

### Improving Recovery Procedures

1. **Add recovery steps**: In configuration file
2. **Test procedures**: Verify commands work
3. **Update documentation**: Document new procedures
4. **Test workflow**: Use manual dispatch to test

### Customizing Issue Templates

1. **Edit script**: Modify `_generate_body` method
2. **Add templates**: In configuration file
3. **Test generation**: Use dry-run mode
4. **Verify formatting**: Check generated issues

## üìö References

- [VSCode Dev Containers](https://code.visualstudio.com/docs/remote/containers)
- [GitHub Actions Workflows](https://docs.github.com/en/actions/using-workflows)
- [Aphrodite Engine Documentation](README.md)
- [Deep Tree Echo Architecture](DEEP_TREE_ECHO_ARCHITECTURE.md)
- [Contributing Guidelines](CONTRIBUTING.md)

---

*ü§ñ This system provides automated error detection and issue creation for Aphrodite Engine development. For questions or issues, contact @dtecho or @drzo.*