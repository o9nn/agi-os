#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# Enable all hardening options
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

# Parallel build
export DEB_BUILD_OPTIONS=parallel=$(shell nproc)

%:
	dh $@ --buildsystem=cmake

override_dh_auto_configure:
	dh_auto_configure -- \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_CXX_STANDARD=20 \
		-DCMAKE_CXX_STANDARD_REQUIRED=ON \
		-DBUILD_SHARED_LIBS=ON

override_dh_auto_build:
	dh_auto_build

override_dh_auto_test:
	# Run tests if available
	dh_auto_test || true

override_dh_auto_install:
	dh_auto_install
	# Install additional files
	install -d debian/cogbolt/usr/share/doc/cogbolt
	install -m 644 README.md debian/cogbolt/usr/share/doc/cogbolt/ || true
	# Install development headers
	install -d debian/cogbolt-dev/usr/include/cogbolt
	cp -r include/* debian/cogbolt-dev/usr/include/cogbolt/ || true

override_dh_strip:
	dh_strip --dbgsym-migration='cogbolt-dbg (<< 1.0.0)'
